import paho.mqtt.client as mqtt

# Configuration
BROKER = "mqtt.phant.om" # Ajouter l'ip dans /etc/hosts
PORT = 17883
TOPIC = "drones/#"
CA_CERT = "./PHANTOM-CA.crt"    # Certificat d'autorité
CLIENT_CERT = "./PHANTOM-CX-8.crt"  # Certificat client
CLIENT_KEY = "./PHANTOM-CX-8.key"   # Clé privée du client

# Callback lors de la connexion
def on_connect(client, userdata, flags, rc):
    print("Connecté avec le code retour:", rc)
    client.subscribe(TOPIC)

# Callback lors de la réception d'un message
def on_message(client, userdata, msg):
    print(f"Message reçu sur {msg.topic}: {msg.payload.decode()}")

# Création du client MQTT
client = mqtt.Client()
client.tls_set(CA_CERT, certfile=CLIENT_CERT, keyfile=CLIENT_KEY)
client.on_connect = on_connect
client.on_message = on_message

# Connexion et boucle
client.connect(BROKER, PORT, 60)
client.loop_forever()
